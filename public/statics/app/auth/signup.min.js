(function($){'use strict';
	$(document).keyup(function(event){
		if(event.keyCode == 13){
			$('#btn-click').click();
		}
	});
	function getPasswordStrength(pw){
	    var pwlength=(pw.length);
	    if(pwlength>5)pwlength=5;
	    var numnumeric=pw.replace(/[0-9]/g,"");
	    var numeric=(pw.length-numnumeric.length);
	    if(numeric>3)numeric=3;
	    var symbols=pw.replace(/\W/g,"");
	    var numsymbols=(pw.length-symbols.length);
	    if(numsymbols>3)numsymbols=3;
	    var numupper=pw.replace(/[A-Z]/g,"");
	    var upper=(pw.length-numupper.length);
	    if(upper>3)upper=3;
	    var pwstrength=((pwlength*10)-20)+(numeric*10)+(numsymbols*15)+(upper*10);
	    if(pwstrength<0){pwstrength=0}
	    if(pwstrength>100){pwstrength=100}
	    return pwstrength;
	}
	$('#btn-click').on('click',function(){
		var i = $.trim($('#name').val());
		var e = $.trim($('#email').val());
		var t = $.trim($('#password').val());
		var n = $.trim($('#password2').val());
		if(!i || !e || !t || !n){
			swal('Không hợp lệ!','Vui lòng nhập tên, địa chỉ mail và mật khẩu hợp lệ vào để đăng ký','error');
			return false
		}
		if(t!=n){
			swal("Lỗi!","Bạn nhập mật khẩu 2 lần không giống nhau!","error");
			return false
		}
		if(getPasswordStrength(t)<40){
			swal("Lỗi!","Mật khẩu đơn giản quá sẽ khiến tài khoản của bạn không an toàn, hãy thử lại!","error");
			return false
		}
		$('#text').text('Đang khởi tạo...');
		$('#btn-click').prop('disabled', true);
		$.post('/auth/ajaxsignup',{name:i,email:e,password:t},function(r){
			var res = $.parseJSON(r);
			if(res.result=='error'){
				swal("Có lỗi xảy ra", res.msg, "error");
				$('#text').text('Thực hiện lại');
				$('#btn-click').prop('disabled', false);
				return false
			}
			swal({title:'Đăng ký thành công',text: res.msg,type:'success',showCancelButton: false,confirmButtonColor:'#8CD4F5',confirmButtonText:'Đăng nhập',closeOnConfirm:false},function(){window.location.replace('/account/setting')});});});})(jQuery);



