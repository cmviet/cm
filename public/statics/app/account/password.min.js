(function ($) {
	'use strict';
	function getPasswordStrength(pw){
	    var pwlength=(pw.length);
	    if(pwlength>5)pwlength=5;
	    var numnumeric=pw.replace(/[0-9]/g,"");
	    var numeric=(pw.length-numnumeric.length);
	    if(numeric>3)numeric=3;
	    var symbols=pw.replace(/\W/g,"");
	    var numsymbols=(pw.length-symbols.length);
	    if(numsymbols>3)numsymbols=3;
	    var numupper=pw.replace(/[A-Z]/g,"");
	    var upper=(pw.length-numupper.length);
	    if(upper>3)upper=3;
	    var pwstrength=((pwlength*10)-20)+(numeric*10)+(numsymbols*15)+(upper*10);
	    if(pwstrength<0){pwstrength=0}
	    if(pwstrength>100){pwstrength=100}
	    return pwstrength;
	}
	$('body').on('keyup', '#password', function () {
	    var pwvalue = $("#password").val();
	    var pwstrength = getPasswordStrength(pwvalue);
	    if (pwstrength<=70) {
	    	$("#pwstr").html("Trung bình");
	    }
	    if (pwstrength<30) {
	    	$("#pwstr").html("Quá yếu");
	    }
	    if (pwstrength>70) {
	    	$("#pwstr").html("Rất tốt");
	    }
	});
	$('body').on('keyup', '#password2', function () {
	    var pw = $("#password").val();
	    var pw2 = $("#password2").val();
	    if(pw == pw2){
	    	$("#pw_cfm").html("Đã khớp");
	    } else
	    	$("#pw_cfm").html("Chưa khớp");
	});
    $(document).on('click', '#password_update', function() {
    	var old_pass = $('#old').val();
    	var new_pass = $('#password').val();
    	var new_very = $('#password2').val();
		if(getPasswordStrength(old_pass)<40){
			swal({title: "Đã có lỗi!", text: "Mật khẩu hiện tại không đúng, hãy kiểm tra và thử lại", timer: 4000, showConfirmButton: false});
			return false
		}
		if(new_pass != new_very){
			swal({title: "Đã có lỗi!", text: "Mật khẩu mới và xác minh không giống nhau!", timer: 4000, showConfirmButton: false});
			return false
		}
		if(getPasswordStrength(new_pass)<40){
			swal({title: "Đã có lỗi!", text: "Mật khẩu mới quá yếu hoặc không hợp lệ", timer: 4000, showConfirmButton: false});
			return false
		}
		var array = [old_pass, new_pass];
		swal({title: "Bạn chắc chứ?", text: "Mật khẩu đăng nhập sẽ được thay thế bằng mật khẩu mới?", type: "warning", showCancelButton: true, confirmButtonColor: "#DD6B55", confirmButtonText: "Thực hiện", cancelButtonText: "Để xem lại đã", closeOnConfirm: false},
		function(){
		    $.post('/account/ajax-password', {data: array}, function(data) {
				var res = $.parseJSON(data);
				if(res.result==='success'){
					swal({title: "Thành công!", text: res.msg, type: "success", timer: 3000, showConfirmButton: false});
				} else {
					swal({title: "Đã có lỗi!", text: res.msg, type: "warning", timer: 4000, showConfirmButton: false});
				}
			});
		});
    });
})(jQuery);