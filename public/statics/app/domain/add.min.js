(function ($) {
	'use strict';
	function validdomain(str){
		if(str.length < 5){
			return false;
		}
		if(/^[a-zA-Z0-9-.]*$/.test(str) == false) {
		    return false;
		}
		return true;
	}
	function checking_dns() {
		$('#domain_table > tr').each(function(){
			var name = $(this).find('.domain_name').html();
			var status = $(this).find('.domain_status');
			var config = $(this).find('.domain_config');
			$.post('/domain/ajax-add-dns', {d: name}, function(data) {
				var res = $.parseJSON(data);
				if(res.result==='error'){
					status.html('<span class="badge bg-danger">'+res.msg+'</span>');
					config.html('<button class="btn btn-mini btn-danger" disabled="">Lỗi</button>');
				} else {
					status.html('<span class="badge bg-primary">Sẵn sàng</span>');
					config.html('<a href="/domain/manager/'+res.msg+'" target="_blank" class="btn btn-mini btn-primary">Tiếp tục</a>');
				}
			});
		});
	}
	$('#check_btn').on('click',function(){
		var list = $('#domain_list').val();
		if(!list || list.length < 5){
			swal({title: "Đã có lỗi", text: "Vui lòng nhập tên miền hợp lệ", type: "warning"});
    		return false;
		}
		var lines = list.split(/\n/);
		var texts = [];
		for (var i=0; i < lines.length; i++) {
			if (/\S/.test(lines[i])) {
				var line = $.trim(lines[i]);
				if(validdomain(line)) {
					texts.push(line);
				}
			}
		}
		if(texts.length < 1){
			swal({title: "Đã có lỗi", text: "Tên miền bạn nhập vào không hợp lệ, vui lòng thử lại", type: "warning"});
    		return false;
		}
		var html = '';
		$.each(texts, function(k, v){
			html += '<tr>';
			html += '<td class="domain_name">'+v+'</td>';
			html += '<td class="text-center domain_status"><i class="fa fa-refresh fa-spin"></i> Đang tải...</td>';
			html += '<td class="text-center domain_config"><i class="fa fa-refresh fa-spin"></i> Đang tải...</td>';
			html += '</tr>';
		});
		$('#domain_table').html(html);
		$('#domain_result').show(1000);
		checking_dns();
	});
})(jQuery);