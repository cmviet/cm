function list_domain() {
	$(function() {
		$.getJSON("/domain/ajax-list", function(data){
			if(data){
				if(data.result=='success'){
					var html = '';
					$.each(data.msg, function(){
						html += '<tr>';
						html += '<td><a href="/domain/manager/'+this.zone_id+'">'+this.domain+'</a></td>';
						html += '<td id="registrar_'+this.zone_id+'">'+this.registrar+'</td>';
						html += '<td>'+this.createdate+'</td>';
						html += '<td>'+this.exp_date+'</td>';
						html += '<td id="status_'+this.zone_id+'" class="pull-right"><i class="fa fa-refresh fa-spin"></i> Checking...</td>';
						html += '</tr>';
					});
					$('#data').html(html);
					load_status();
				} else
					$('#data').html('<td colspan="5"><center><br /><a href="/domain/new-domain" class="btn btn-primary"> Mua tên miền mới</a> <a href="/domain/transder-domain" class="btn btn-success"> Chuyển tên miền về SB</a> <a href="/domain/add-domain" class="btn btn-danger"> Thêm tên miền có sẵn</a></center></td>');
			} else
				$('#data').html('<td colspan="5"><center><i class="fa fa-warning"></i> Đã có lỗi xảy ra, vui lòng thử lại </center></td>');
		});
	});
}
function load_status() {
	$(function() {
		$('[id^="status_"]').each(function() {
			var status, label, n;
			n = $(this).attr('id').replace('status_', '');
			if(!n){return false}
			$.getJSON("/domain/ajax-status?i="+n, function(data){
				if(data.result=='success'){
					if(data.msg.status=='active'){
						status = 'Đang h.động';
						label = 'primary';
					} else if(data.msg.status=='pending'){
						status = 'Đợi cập nhật Name Servers';
						label = 'warning';
					}
					$('#status_'+n).html('<span class="label label-'+label+'">'+status+'</span>');
					var registrar = $('#registrar_'+n).html();
					if(!registrar){
						$('#registrar_'+n).html(data.msg.registrar);
					}
				} else
					$('#status_'+n).html('<span class="label label-danger">Lỗi lấy t.tin</span>');
			});
		});
	});
}
$(function() {list_domain()});