function list_instance() {
	$(function() {
		$.getJSON("/instance/ajax-list", function(data){
			if(data){
				if(data.result=='success'){
					var html = '';
					$.each(data.msg, function(){
						html += '<tr>';
						html += '<td><a href="/instance/manager/'+this.id+'">'+this.hostname+'</a></td>';
						html += '<td><a href="/instance/manager/'+this.id+'">'+this.ip_addr+'</a></td>';
						html += '<td>'+this.os_name+'</td>';
						html += '<td>'+this.ram+'G - '+this.plan+'</td>';
						html += '<td>'+this.createdate+'</td>';
						html += '<td id="status_'+this.id+'"><i class="fa fa-refresh fa-spin"></i> Checking...</td>';
						html += '</tr>';
					});
					$('#data').html(html);
					load_status();
				} else
					$('#data').html('<td colspan="6"><center><br /><a href="/instance/new-instance" class="btn btn-primary"> Tạo máy chủ đầu tiên</a></center></td>');
			} else
				$('#data').html('<td colspan="6"><center><i class="fa fa-warning"></i> Đã có lỗi xảy ra, vui lòng thử lại </center></td>');
		});
	});
}
function load_status() {
	$(function() {
		$('[id^="status_"]').each(function() {
			var html, n;
			n = $(this).attr('id').replace('status_', '');
			if(!n){return false}
			$.getJSON("/instance/ajax-manager?i="+n, function(data){
				if(data.result=='success'){
					if(data.msg.status == 0){
						html = '<span class="label label-danger">Đã tắt</span>';
					} else if(data.msg.status == 2){
						html = '<span class="label label-warning">Đã đình chỉ</span>';
					} else
						html = '<span class="label label-success">Đang chạy</span>';
					$('#status_'+n).html(html);
				} else {
					$('#status_'+n).html('<span class="label label-warning">'+data.msg+'</span>');
				}
			});
		});
	});
}
$(function() {list_instance();setInterval(load_status, 20000)});